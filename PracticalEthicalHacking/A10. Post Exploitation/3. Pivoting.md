3. Pivoting

## Lab Setup
On W1, change the network e.g. add it to a 10.10.12.0/24 network
Once it is done, we bring the machines. Edit W1 and ADD a second network adapter "Custom:Virtual NAT network" (the new one we created)

On W2, we move it to the NAT network

I.e. W1 on both 10.10.10.0/24 AND 10.10.12.0/24

W2 only on 10.10.12.0/24

DC on 10.10.10.0/24


We will use psexec on metasploit

![2f6d9b92a959341715e2ef3a525e96a8.png](../../_resources/517ce25ef6414a209a3421b31353aed8.png)


We get a shell. Do a `route print` (from the Windows shell) to see the network 

![75eb1d01f3c3a8069210bdd4db761972.png](../../_resources/b626bc69d5df4db6a82121d8fedadea7.png)

![99a01668ac7ced4f6d185f2e90d18260.png](../../_resources/63186323edca4c278588f06c2ca7f332.png) 

From meterpreter

```
meterpreter> run autoroute -s 10.10.12.0/24
```
![d2c118d5c9c3a8d0c1482d0dd405c102.png](../../_resources/76ca7d6b41fe41d4a85bc3d6744251b5.png)

From the IP we exploited, in 10.10.10.0/24, we try to pivot/ make a route to the 10.10.12.0/24 network

Now we can do

```
meterpreter> run autoroute -p
```
to check we have a route 

![d95bb1250b9b2009de5754c8ce0de2a0.png](../../_resources/5774fd86b78c4fcd881617c1d1c3d13f.png)

Background the session

```
meterpreter> background
```

Now using a scanner on metasploit we see that we do have access to this new network (as we can scan the ports)

![e5197f3687fd5120c363212a88c2e935.png](../../_resources/0c6d26aec9304f898072c66a76e7c621.png)




